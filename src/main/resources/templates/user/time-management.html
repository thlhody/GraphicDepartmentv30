<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}" lang="en">
<head>
    <title>Time Management</title>
    <link rel="stylesheet" th:href="@{/css/time-management.css?v=081120251622}">
    <link rel="stylesheet" th:href="@{/css/holiday-request-modal.css?v=081120251622}">
</head>
<body>
<div layout:fragment="content">
    <!-- Header for standalone page -->
    <div class="container py-4">
        <div class="page-header d-flex justify-content-between align-items-center mb-4">
            <div class="d-flex align-items-center gap-3">
                <h1 class="header-title"><i class="bi bi-calendar-clock me-2"></i>Time Management</h1>
                <div class="badge bg-primary rounded-pill">
                    <i class="bi bi-person me-2"></i>
                    <span th:text="${user.name}"></span>
                </div>
                <div class="badge bg-secondary rounded-pill">
                    <i class="bi bi-calendar me-1"></i>
                    <span th:text="${T(java.time.Month).of(currentMonth)} + ' ' + ${currentYear}">Current Month</span>
                </div>
            </div>
            <!-- Session button -->
            <a th:href="@{/user/session}" class="btn btn-outline-primary btn-sm" data-bs-toggle="tooltip"
               title="Go to Session Management page">
                <i class="bi bi-play-circle me-1"></i>Session
            </a>
            <!-- Dashboard button -->
            <a class="btn btn-outline-primary" th:href="${dashboardUrl}">
                <i class="bi bi-grid me-2"></i>Dashboard
            </a>
        </div>
    </div>

    <!-- Include the fragment content -->
    <div id="timeManagementContent">
        <div th:insert="~{user/fragments/time-management-fragment :: content}"></div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay d-none">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Saving...</span>
        </div>
    </div>
</div>

<!-- Page Scripts -->
<th:block layout:fragment="scripts">
    <!-- Server data for JavaScript -->
    <script type="application/json" id="timeOffResultData">
        {
            "openHolidayModal": "[[${openHolidayModal ?: false}]]",
            "holidayStartDate": "[[${holidayStartDate ?: ''}]]",
            "holidayEndDate": "[[${holidayEndDate ?: ''}]]",
            "holidayTimeOffType": "[[${holidayTimeOffType ?: ''}]]",
            "successMessage": "[[${successMessage ?: ''}]]"
        }
    </script>

    <!-- ES6 Module (Modern Browsers) -->
    <script type="module">
        const cacheBuster = new Date().getTime();
            import(`/js/features/time-management/index.js?v=081120251622${cacheBuster}`)
        
                .then(() => console.log('✅ Time Management (Standalone) - ES6 module loaded'))
                .catch(err => console.error('❌ Error loading module:', err));
    </script>

    <!-- Legacy Fallback (IE11) -->
    <script nomodule th:src="@{/js/legacy/toast-alerts.js}"></script>
    <script nomodule th:src="@{/js/legacy/tm/utilities-module.js}"></script>
    <script nomodule th:src="@{/js/legacy/tm/time-input-module.js}"></script>
    <script nomodule th:src="@{/js/legacy/tm/status-display-module.js}"></script>
    <script nomodule th:src="@{/js/legacy/tm/work-time-display-module.js}"></script>
    <script nomodule th:src="@{/js/legacy/tm/inline-editing-module.js}"></script>
    <script nomodule th:src="@{/js/legacy/tm/timeoff-management-module.js}"></script>
    <script nomodule th:src="@{/js/legacy/tm/period-navigation-module.js}"></script>
    <script nomodule th:src="@{/js/legacy/tm/holiday-export-utils.js}"></script>
    <script nomodule th:src="@{/js/legacy/tm/holiday-request-modal.js}"></script>
    <script nomodule th:src="@{/js/legacy/time-management-core.js}"></script>
    <script nomodule th:src="@{/js/legacy/standalone-time-management.js}" defer></script>
    <script nomodule>
        console.log('⚠️ Time Management (Standalone) - Legacy fallback loaded');
    </script>
</th:block>
</body>
</html>