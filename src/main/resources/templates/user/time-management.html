<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}" lang="en">
<head>
    <title>Time Management</title>
    <link rel="stylesheet" th:href="@{/css/toast-alerts.css?v=1910251535}">
    <link rel="stylesheet" th:href="@{/css/time-management.css?v=191020251636}">
    <link rel="stylesheet" th:href="@{/css/holiday-request-modal.css?v=1910251535}">
</head>
<body>
<div layout:fragment="content">

    <!-- Toast Alert Container -->
    <div id="toastAlertContainer" class="toast-alert-container"></div>

    <!-- Header for standalone page -->
    <div class="container py-4">
        <div class="page-header d-flex justify-content-between align-items-center mb-4">
            <div class="d-flex align-items-center gap-3">
                <h1 class="header-title"><i class="bi bi-calendar-clock me-2"></i>Time Management</h1>
                <div class="badge bg-primary rounded-pill">
                    <i class="bi bi-person me-2"></i>
                    <span th:text="${user.name}"></span>
                </div>
                <div class="badge bg-secondary rounded-pill">
                    <i class="bi bi-calendar me-1"></i>
                    <span th:text="${T(java.time.Month).of(currentMonth)} + ' ' + ${currentYear}">Current Month</span>
                </div>
            </div>
            <!-- Session button -->
            <a th:href="@{/user/session}" class="btn btn-outline-primary btn-sm" data-bs-toggle="tooltip"
               title="Go to Session Management page">
                <i class="bi bi-play-circle me-1"></i>Session
            </a>
            <!-- Dashboard button -->
            <a class="btn btn-outline-primary" th:href="${dashboardUrl}">
                <i class="bi bi-grid me-2"></i>Dashboard
            </a>
        </div>
    </div>

    <!-- Include the fragment content -->
    <div id="timeManagementContent">
        <div th:insert="~{user/fragments/time-management-fragment :: content}"></div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay d-none">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Saving...</span>
        </div>
    </div>
</div>

<!-- Page Scripts -->
<th:block layout:fragment="scripts">
    <!-- Toast alerts -->
    <script th:src="@{/js/toast-alerts.js?v=1910251535}"></script>

    <!-- Core utilities first (same as session.html) -->
    <script th:src="@{/js/tm/utilities-module.js?v=1910251535}"></script>
    <script th:src="@{/js/tm/time-input-module.js?v=1910251535}"></script>

    <!-- Feature modules (same as session.html) -->
    <script th:src="@{/js/tm/status-display-module.js?v=1910251535}"></script>
    <script th:src="@{/js/tm/work-time-display-module.js?v=1910251535}"></script>
    <script th:src="@{/js/tm/inline-editing-module.js?v=1910251535}"></script>
    <script th:src="@{/js/tm/timeoff-management-module.js?v=1910251535}"></script>
    <script th:src="@{/js/tm/period-navigation-module.js?v=1910251535}"></script>

    <!-- Holiday request functionality -->
    <script th:src="@{/js/tm/holiday-export-utils.js?v=1910251535}"></script>
    <script th:src="@{/js/tm/holiday-request-modal.js?v=1910251535}"></script>

    <!-- Server data for JavaScript -->
    <script type="application/json" id="timeOffResultData">
        {
            "openHolidayModal": "[[${openHolidayModal ?: false}]]",
            "holidayStartDate": "[[${holidayStartDate ?: ''}]]",
            "holidayEndDate": "[[${holidayEndDate ?: ''}]]",
            "successMessage": "[[${successMessage ?: ''}]]"
        }
    </script>

    <!-- Time Management Core coordinator -->
    <script th:src="@{/js/time-management-core.js?v=1910251535}"></script>

    <!-- Standalone initialization script -->
    <script th:src="@{/js/standalone-time-management.js?v=1910251535}" defer></script>
</th:block>
</body>
</html>